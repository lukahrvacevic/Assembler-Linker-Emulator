# Assembler-Linker-Emulator
Implementation of a toolchain consisting of an assembler, a linker and an emulator,
similar to the GNU one, made for a hypothethical 16-bit architecture explained 
in detail in the documentation, where you can find all the supported instructions
and directives, as well as a guide on how to use the implemented timer and terminal peripheries.

## Build

By running the following command:
``` bash
$ ./build.sh
```
three executable programs will be generated: **assembler**, **linker** and **emulator**.

### Assembler

Represents a one-pass assembler made for the hypothetical machine. Input of the assembler
is a text file with source assembly code written according to the syntax defined in the
docs/pdf file. Output of the assembler is an object program which is based on a simplified
version of the ELF format.

This tool is used as follows
``` bash
assembler [options] <input_file_name>
```

Options:

**-o <output_file_name>**<br>
This option sets the output file name parameter for the output file that is
the result of assembling.

Example of startup:

``` bash
./assembler -o output.o input.s
```

### Linker

Represents a linker whose task is to link one or more object programs generated
by the aforementioned assembler. The linker processes object programs 
at its input in the order in which they are listed through the command line.

This tool is used as follows
``` bash
linker [options] <input_file_name> [<input_file2_name> ...]
```

Options:

**-o <output_file_name>**<br>
This option sets the output file name parameter for the output file that is
the result of linking.

**-place=<section_name>@<start_address>**<br>
This option sets the address for the section specified with the 
section name. 

**-hex**<br>
This option tells the linker to try to generate an executable file that
can then be an input to the emulator. Linking is only successful if there are
no multiple definitions for the same symbol, no unresolved symbols and no
overlap between the sections which starting addresses are defined by the place option.

**-relocateable**<br>
This option tells the linker to generate an object program, in the same format
as the output of the assembler, ignoring the place options defined by the user.

NOTE: Either hex or relocateable option(not both) must be turned on for the linker to have an output.

Example of startup:

``` bash
./linker -hex -place=iv_table@0x0000 -place=text@0x4000 -o mem_content.hex input1.s input2.s
```

### Emulator

Represents an interpretative emulator for the hypothethical architecture described
through out this project. Input of the emulator is the output file generated by
the linker with the -hex option turned on. Emulation is possible only if it's
possible to load the input file into the memory address space of the emulated computer system. 

This tool is used as follows
``` bash
emulator <input_file_name>
```

Example of startup:

``` bash
./emulator mem_content.hex
```

## Tests

In the tests folder, some tests written to test the functionalities of the toolchain can
be found. Example of a shell script necessary to run the timerTest:

``` shell
ASSEMBLER=...
LINKER=...
EMULATOR=...
#Here should be the paths to the executable programs

${ASSEMBLER} -o ivt.o ivt.s
${ASSEMBLER} -o main.o main.s
${ASSEMBLER} -o timer_int.o timer_int.s
${LINKER} -hex -o program.hex -place=ivt@0x0000 ivt.o main.o timer_int.o
${EMULATOR} program.hex
```

## To-do

- Code refactorization: This project was done in a hurry, so the code
is not very comprehensible, needs to be broken down into smaller parts
including more classes and more methods.
- Translating error output and comments from Serbian to English
- Find a Windows replacement for <termios.h> header: Right now this
toolchain can only be built and run on Linux
- Replace usages of exit with exceptions

